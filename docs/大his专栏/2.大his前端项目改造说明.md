# 大 his 前端项目改造说明

## 背景

由于追求操作的更加便利、更加人性化，大 his 项目将以功能菜单为单位实现

- 不同系统的功能菜单自由组合成新的系统（用户可以将不同系统的功能菜单组合成它的日常使用系统）
- 大 his 系统之间能够随意切换（避免用户切换系统需要回到 portal 页面然后重新进入某个系统）

## 技术方案

现有的大 his 前端项目均为 spa 单页面应用，系统之间无法切换、即使强行使用 iframe 包裹不同系统，也会有面临诸多不可接受的体验问题

- 遮罩层无法覆盖全屏
- 功能菜单之间通信难
- header 头部重复
- iframe 内页面刷新无法保持状态

&nbsp;&nbsp;&nbsp;&nbsp;所以我们采用目前正在流行开来的微前端解决方案，采用阿里的微前端实现库 qiankun 来改造现有的大 his 项目，大临床也已经采用。在采用微应用的基础上，我们将项目拆分为不同的子项目（也就是功能菜单），所有子项目由同一个基座加载组合成为一个系统。大 his 中，我们已经开发好了基座（主项目）winning-web-his-main，该项目主要包括头部、脚部、同时负责加载子项目，所以大家在开发子页面（子项目）的时候不需要考虑这部分功能了，这也是实现菜单可以收藏的基本原理。

## 改造步骤

改造的工作是复杂繁琐的，为了在一定程度上减少改造成本、同时统一大 his 项目规范、减少项目后期维护成本。我们提供了大 his 项目初始化工具 his-cli。

### 在现有项目基础上新建 develop_his 分支。

![在现有项目基础上新建 develop_his 分支](../../assets/img/reform3.1.png)

### 删除 develop_his 分支下所有文件

![在现有项目基础上新建 develop_his 分支](../../assets/img/reform3.2.png)

### 在 develop_his 分支中 使用 his-cli 工具初始化项目

> 注意：请确保 npm 源地址为 winning 私服 http://nexus.winning.com.cn:8081/repository/npm-group/， 建议使用 源管理 nrm 管理

#### 创建模版项目

![创建模板项目](../../assets/img/reform3.3.1.png)

#### 将 temp 文件夹内所有文件移到 temp 文件夹外并删除 空的 temp 临时文件夹

![将 temp 文件夹内所有文件移到 temp 文件夹外并删除 空的 temp 临时文件夹](../../assets/img/reform3.3.2.png)

#### 在 develop_his 分支下执行命令 yarn serve or npm run serve 查看能否在本地启动成功

![在 develop_his 分支下执行命令 yarn serve or npm run serve 查看能否在本地启动成功](../../assets/img/reform3.3.3.png)

### 将之前的老代码（develop 分支）迁移到新建的项目中（develop_his 分支）

重点：总体思路是将之前的功能页面改造为独立微应用子项目

#### 查看 develop 分支下有那些功能菜单，可以先迁移某个功能菜单(修改 packages/project1 为某个子模块)

> 注意: 同步修改配置文件 service.cofig.js

![查看develop分支下有那些功能菜单，可以先迁移某个功能菜单(修改packages/project1 为某个子模块) ](../../assets/img/reform4.1.png)

#### 将之前的 acctManagemet 模块 代码 迁移到 packages/acctManagement，注意之前一些公用的 store、公用的样式、图片样式等迁移

### 大 his 项目模版

- his 脚手架地址 [https://github.com/winning-finance/his-cli](https://github.com/winning-finance/his-cli)（私有项目，需要权限，有问题直接发 his 改造群）
- 主项目模版 [https://github.com/winning-finance/winning-micro-frontend-template](https://github.com/winning-finance/winning-micro-frontend-template)
- 子项目模版 [https://github.com/winning-finance/sub-micro-app-vue-template](https://github.com/winning-finance/sub-micro-app-vue-template)
