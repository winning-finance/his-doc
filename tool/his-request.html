<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HIS-前端开发手册</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/his-doc/favicon.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/his-doc/assets/css/0.styles.cdf22441.css" as="style"><link rel="preload" href="/his-doc/assets/js/app.83286a23.js" as="script"><link rel="preload" href="/his-doc/assets/js/2.44c420b6.js" as="script"><link rel="preload" href="/his-doc/assets/js/21.7a6e375e.js" as="script"><link rel="prefetch" href="/his-doc/assets/js/10.353d2d52.js"><link rel="prefetch" href="/his-doc/assets/js/11.ed3cda32.js"><link rel="prefetch" href="/his-doc/assets/js/12.5a72eb68.js"><link rel="prefetch" href="/his-doc/assets/js/13.23280a93.js"><link rel="prefetch" href="/his-doc/assets/js/14.6831825b.js"><link rel="prefetch" href="/his-doc/assets/js/15.e1de5828.js"><link rel="prefetch" href="/his-doc/assets/js/16.2ada8eb0.js"><link rel="prefetch" href="/his-doc/assets/js/17.3e741533.js"><link rel="prefetch" href="/his-doc/assets/js/18.94e26684.js"><link rel="prefetch" href="/his-doc/assets/js/19.7594b319.js"><link rel="prefetch" href="/his-doc/assets/js/20.c66ad016.js"><link rel="prefetch" href="/his-doc/assets/js/22.166761f9.js"><link rel="prefetch" href="/his-doc/assets/js/23.004c5ed5.js"><link rel="prefetch" href="/his-doc/assets/js/24.c4f85436.js"><link rel="prefetch" href="/his-doc/assets/js/25.07791bad.js"><link rel="prefetch" href="/his-doc/assets/js/26.61303b84.js"><link rel="prefetch" href="/his-doc/assets/js/27.32da09bf.js"><link rel="prefetch" href="/his-doc/assets/js/3.ac070aef.js"><link rel="prefetch" href="/his-doc/assets/js/4.34370cde.js"><link rel="prefetch" href="/his-doc/assets/js/5.682ae053.js"><link rel="prefetch" href="/his-doc/assets/js/6.23cdb6c1.js"><link rel="prefetch" href="/his-doc/assets/js/7.1c9dbee7.js"><link rel="prefetch" href="/his-doc/assets/js/8.ecd039cc.js"><link rel="prefetch" href="/his-doc/assets/js/9.0f528429.js">
    <link rel="stylesheet" href="/his-doc/assets/css/0.styles.cdf22441.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><section><div><header class="doc-header"><h2 class="doc-header-logo"><a href="/his-doc/" class="router-link-active"><img src="/his-doc/assets/img/his.647a9dbf.svg" alt=""> <span>前端开发手册</span></a></h2> <ul class="doc-header-nav"><li class="doc-header-nav-item"><a href="/his-doc/guide/" class="doc-header-nav-item-link">
          指南
        </a></li><li class="doc-header-nav-item"><a href="/his-doc/tool/" class="doc-header-nav-item-link router-link-active">
          工具
        </a></li><li class="doc-header-nav-item"><a href="/his-doc/standard/" class="doc-header-nav-item-link">
          规范
        </a></li></ul></header></div> <main class="doc-main typo doc-main-md"><aside class="doc-aside"><ul class="doc-aside-nav"><li><a href="/his-doc/tool/" class="router-link-active">工具概览</a></li><li><a href="/his-doc/tool/his-cli.html">his-cli 脚手架</a></li><li><a href="/his-doc/tool/his-request.html" aria-current="page" class="router-link-exact-active router-link-active">his-request 请求</a></li><li><a href="/his-doc/tool/hot-key.html">hot-key 热键方案</a></li><li><a href="/his-doc/tool/micro-app.html">@winning/micro-app</a></li><li><a href="/his-doc/tool/vue-cli-plugin-his.html">vue-cli 插件</a></li><li><a href="/his-doc/tool/winning-cookie-webpack-plugin.html">webpack 自动登陆插件</a></li><li><a href="/his-doc/tool/winning-dll.html">winning-dll 组件</a></li><li><a href="/his-doc/tool/winning-micro-app-service.html">wms 使用文档</a></li></ul></aside> <div class="content__default"><h2 id="his-request-请求"><a href="#his-request-请求" class="header-anchor">#</a> his-request 请求</h2> <blockquote><p>基于axois封装的request插件</p></blockquote> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <p>将npm源切换为winning</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> his-request -S
</code></pre></div><p>或者</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> his-request -S
</code></pre></div><h3 id="支持"><a href="#支持" class="header-anchor">#</a> 支持</h3> <ul><li>自定义请求配置</li> <li>响应成功及异常的全局拦截统一处理</li> <li>防止重复请求（取消当前重复的请求）</li> <li>提供ued 标准的详情错误信息弹窗</li> <li>支持对同一个URL的同一时间发出的多个请求，后面的覆盖之前的</li> <li>取消当前所有pending状态的请求</li></ul> <h3 id="todo-后续支持"><a href="#todo-后续支持" class="header-anchor">#</a> todo (后续支持)</h3> <ul><li>根据业务需要扩展功能</li></ul> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <p><strong>his-request</strong>  本质上为一个js类，核心功能提供了生成和后端交互的方法，</p> <p>1、 初始化</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Request <span class="token keyword">from</span> <span class="token string">'his-request'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>

<span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">baseUrl</span><span class="token operator">:</span> isProduction <span class="token operator">?</span> <span class="token string">'/finance-mdm'</span> <span class="token operator">:</span> <span class="token string">'http://172.16.6.201:41200'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">warning</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 默认为 ture （是否使用默认错误提示）</span>
  <span class="token literal-property property">isAddHospitalSoid</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 默认为true （这里只是展示）</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> request
</code></pre></div><p>2、 生成请求</p> <p>核心 <code>temp</code> 方法返回一个promise对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/** 本服务计费 */</span>
<span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'...'</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> temp <span class="token punctuation">}</span> <span class="token operator">=</span> request
<span class="token keyword">export</span> <span class="token keyword">const</span> addOriginService <span class="token operator">=</span> <span class="token function">temp</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">failTxt</span><span class="token operator">:</span> <span class="token string">'本服务计费设置添加失败！'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">successTxt</span><span class="token operator">:</span> <span class="token string">'本服务计费设置添加成功！'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">warning</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 关闭默认弹窗</span>
  <span class="token function-variable function">transformData</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token operator">...</span> <span class="token comment">// 处理data 的钩子</span>
    <span class="token keyword">return</span> data
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">checkFn</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	 <span class="token operator">...</span> <span class="token comment">// 可以校验api 入参 是否合法，不合法则取消这次请求</span>
	 <span class="token keyword">return</span> data
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>3、页面中调用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> addOriginService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'...'</span>
<span class="token function">addOriginService</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token operator">...</span>  <span class="token comment">// 入参</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span> <span class="token comment">// 个性化配置 （非必需，可覆盖之前的配置信息）</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="静态方法"><a href="#静态方法" class="header-anchor">#</a> 静态方法</h3> <p>一. <code>getCookieData</code></p> <p>该方法获取 <code>cookie</code> 信息, 它放回一个<code>object</code> 包括 user 、header 信息</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Request <span class="token keyword">from</span> <span class="token string">'his-request'</span>
<span class="token comment">/*
* @return { Object } Cookies
*/</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> userInfo<span class="token punctuation">,</span> header <span class="token punctuation">}</span> <span class="token operator">=</span> Request<span class="token punctuation">.</span><span class="token function">getCookieData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>返回数据</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">employeeId</span><span class="token operator">:</span> <span class="token comment">// 员工id</span>
    <span class="token literal-property property">userId</span><span class="token operator">:</span> <span class="token comment">// 用户id</span>
    <span class="token literal-property property">employeeNo</span><span class="token operator">:</span> <span class="token comment">// 员工号</span>
    <span class="token literal-property property">employeeName</span><span class="token operator">:</span> <span class="token comment">// 员工姓名</span>
    <span class="token literal-property property">hospitalSOID</span><span class="token operator">:</span> <span class="token comment">// 医院soid </span>
    <span class="token literal-property property">userHospitalSOID</span><span class="token operator">:</span> <span class="token comment">// 员工所属于医院 soid</span>
    <span class="token literal-property property">orgName</span><span class="token operator">:</span> <span class="token comment">// 员工组织名称</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// BEARER_TOKEN</span>
    <span class="token string-property property">'W-FLOW'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">//</span>
    <span class="token string-property property">'X-DEBUG'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ip</span><span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>二. <code>getPendingRequestMap</code></p> <p>获取所有pending状态的请求</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Request <span class="token keyword">from</span> <span class="token string">'his-request'</span>

<span class="token comment">/*
* @return { Map } pending 状态的map对象
*/</span>
Request<span class="token punctuation">.</span><span class="token function">getPendingRequestMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>三. <code>clear</code></p> <p>清除所有pending 状态请求</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Request <span class="token keyword">from</span> <span class="token string">'his-request'</span>

<span class="token comment">/*
* @parmas { Array } whiteList 白名单，白名单中的URL 不取消
* @return { Array } 被取消的url列表
*/</span>
Request<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">[</span>url<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>建议:</strong></p> <ul><li>可以在 vue 中 destroy 钩子中使用，另外可以使用全局mixin, 只要写在一个地方就可以了</li> <li>在temp方法生成具体request的时候可以配置 global 为 true, 表示为全局请求，将不会被取消</li></ul> <p>四. <code>asyncClear</code></p> <p>使用方法同 <code>clear</code>, 不过它是一个 promise 对象</p> <p><strong>注意:</strong> 如果你在具体页面中使用 clear, 要使用该方法，由于 axios 中的 request 都是 promise, 根据 JavaScript 解释器的机制， 它为微任务，所以使用 clear 将无法实现效果，必须使用 <code>asyncClear</code></p> <h3 id="配置说明-config"><a href="#配置说明-config" class="header-anchor">#</a> 配置说明（config）</h3> <p>考虑同一个api在不同的页面有不同的应用场景，<strong>his-request</strong> 提供了三层配置场景，你可以在<code>初始化</code>、<code>生成请求方法</code>、<code>页面方法调用</code>、后面的配置参数会覆盖之前的配置。</p> <table><thead><tr><th>Param Name</th> <th>Required</th> <th>Description</th></tr></thead> <tbody><tr><td>Message</td> <td>否</td> <td>统一报错的方法，默认取winning-componets里Message-Ex的方法</td></tr> <tr><td>baseUrl</td> <td>否</td> <td>url统一前缀，不传的话为空字符串</td></tr> <tr><td>isAddHospitalSoid</td> <td>否</td> <td>是否统一加hospitalSOID, 默认为 true</td></tr> <tr><td>warning</td> <td>否</td> <td>接口出错时是否提示，默认为ture</td></tr> <tr><td>cover</td> <td>否</td> <td>是否覆盖上一个pending状态的请求</td></tr> <tr><td>repeat</td> <td>否</td> <td>是否允许重复请求</td></tr> <tr><td>transformData</td> <td>否</td> <td>在请求发出前对入参重新定义的方式，无默认值</td></tr> <tr><td>checkFn</td> <td>否</td> <td>在请求发出前，对入参进行校验的方法，未通过则取消请求，无默认值</td></tr> <tr><td>checkWarning</td> <td>否</td> <td>当提供checkFn且checkFn 未通过时，是否提示错误信息， 默认为true</td></tr></tbody></table></div></main> <footer class="doc-footer"></footer></section><div class="global-ui"></div></div>
    <script src="/his-doc/assets/js/app.83286a23.js" defer></script><script src="/his-doc/assets/js/2.44c420b6.js" defer></script><script src="/his-doc/assets/js/21.7a6e375e.js" defer></script>
  </body>
</html>
